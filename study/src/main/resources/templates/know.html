<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{fragments/layout}">

<body layout:fragment="content" style="position: relative;">
	<div class="row d-flex flex-nowrap">
		<div class="col-4 mt-5" style="width:200px; margin-left: 50px; position: fixed;">
			<nav id="know" class="h-100 flex-column align-items-stretch pe-4 border-end">
				<nav class="nav nav-pills flex-column">
					<a class="nav-link" href="#network">네트워크</a>
					<a class="nav-link" href="#java1">자바</a>
					<nav class="nav nav-pills flex-column">
						<a class="nav-link ms-3 my-1" href="#java1">기초</a>
						<a class="nav-link ms-3 my-1" href="#java2">심화</a>
					</nav>
					<a class="nav-link" href="#git">GIT</a>
				</nav>
			</nav>
		</div>

		<div class="col-8" style="margin-left: 300px; top: 107px;">
			<div data-bs-spy="scroll" data-bs-target="#know" data-bs-smooth-scroll="true" tabindex="0">
				<div class="container px-4 py-5 my-3" id="network">
					<h2 class="pb-2 border-bottom">네트워크</h2>
					<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mt-3"
						style="height: 500px; overflow: scroll;">

						<div th:each="know : ${map.list0}" class="col d-flex align-items-start">
							<button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#knowModal"
								th:onclick="know([[${know.getName()}]])">
								<h3 class="fw-bold mb-0 fs-4">[[${know.getName()}]]</h3>
							</button>

						</div>
					</div>

				</div>
			</div>


			<div class="container px-4 py-5 my-3" id="java1">
				<h2 class="pb-2 border-bottom">자바(기초)</h2>
				<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mt-3"
					style="height: 500px; overflow: scroll;">
					<div class="col d-flex align-items-start">
						<div>
							<h3 class="fw-bold mb-0 fs-4">인터넷</h3>
						</div>
					</div>
					<div class="col d-flex align-items-start">
						<div>
							<h3 class="fw-bold mb-0 fs-4">TCP / IP 프로토콜</h3>
						</div>
					</div>
					<div class="col d-flex align-items-start">
						<div>
							<h3 class="fw-bold mb-0 fs-4">DNS 주소</h3>
						</div>
					</div>
				</div>
			</div>

			<div class="container px-4 py-5 my-3" id="java2">
				<h2 class="pb-2 border-bottom">자바(심화)</h2>
				<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mt-3"
					style="height: 500px; overflow: scroll;">
					<div class="col d-flex align-items-start">
						<div>
							<h3 class="fw-bold mb-0 fs-4">인터넷</h3>
						</div>
					</div>
					<div class="col d-flex align-items-start">
						<div>
							<h3 class="fw-bold mb-0 fs-4">TCP / IP 프로토콜</h3>
						</div>
					</div>
					<div class="col d-flex align-items-start">
						<div>
							<h3 class="fw-bold mb-0 fs-4">DNS 주소</h3>
						</div>
					</div>
				</div>
			</div>

		</div>

		<div class="flex-shrink-0 p-3 bg-white">
			<a href="#" th:if="${session.loginUser != null}"
				class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
				<img th:src="@{/upload/images?file=} + ${session.loginUser?.profile}" width="32" height="32"
					class="rounded-circle">
				<span class="fs-5 fw-semibold p-2" th:text="${session.loginUser?.nick}"></span>
			</a>
			<a href="#" th:if="${session.loginUser == null}"
				class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
				<img width="32" height="32" class="rounded-circle">
				<span class="fs-5 fw-semibold p-2" data-bs-toggle="modal" data-bs-target="#loginModal">로그인 해주세요.</span>
			</a>
			<ul class="list-unstyled ps-0">
				<li th:if="${session.loginUser != null}" class="mb-1">
					<button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed"
						data-bs-toggle="collapse" data-bs-target="#account-collapse" aria-expanded="false">
						계정
					</button>
					<div class="collapse" id="account-collapse">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded"
									data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-target="#updateUserModal">
									내 정보 변경</a>
							</li>
						</ul>
					</div>
				</li>
				<li class="mb-1">
					<button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed"
						data-bs-toggle="collapse" data-bs-target="#home-collapse" aria-expanded="false">
						홈페이지
					</button>
					<div class="collapse" id="home-collapse">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="/#network" class="link-dark d-inline-flex text-decoration-none rounded">오늘의 문제
									- 네트워크</a></li>
							<li><a href="/#java1" class="link-dark d-inline-flex text-decoration-none rounded">오늘의 문제 -
									자바(기초)</a></li>
							<li><a href="/#java2" class="link-dark d-inline-flex text-decoration-none rounded">오늘의 문제 -
									자바(심화)</a></li>
							<li><a href="/#java3" class="link-dark d-inline-flex text-decoration-none rounded">오늘의 문제 -
									자바(프레임워크)</a></li>
						</ul>
					</div>
				</li>
				<li class="mb-1">
					<button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed"
						data-bs-toggle="collapse" data-bs-target="#know-collapse" aria-expanded="false">
						지식
					</button>
					<div class="collapse" id="know-collapse">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="/know#network"
									class="link-dark d-inline-flex text-decoration-none rounded">네트워크</a></li>
							<li><a href="/know#java1"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(기초)</a></li>
							<li><a href="/know#java2"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(심화)</a></li>
							<li><a href="/know#java3"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(프레임워크)</a></li>
						</ul>
					</div>
				</li>
				<li class="mb-1">
					<button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed"
						data-bs-toggle="collapse" data-bs-target="#short-collapse" aria-expanded="false">
						문제(단답형)
					</button>
					<div class="collapse" id="short-collapse">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="/prob/short#network"
									class="link-dark d-inline-flex text-decoration-none rounded">네트워크</a></li>
							<li><a href="/prob/short#java1"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(기초)</a></li>
							<li><a href="/prob/short#java2"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(심화)</a></li>
							<li><a href="/prob/short#java3"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(프레임워크)</a></li>
						</ul>
					</div>
				</li>
				<li class="mb-1">
					<button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed"
						data-bs-toggle="collapse" data-bs-target="#long-collapse" aria-expanded="false">
						문제(주관식)
					</button>
					<div class="collapse" id="long-collapse">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="/prob/long#network"
									class="link-dark d-inline-flex text-decoration-none rounded">네트워크</a></li>
							<li><a href="/prob/long#java1"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(기초)</a></li>
							<li><a href="/prob/long#java2"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(심화)</a></li>
							<li><a href="/prob/long#java3"
									class="link-dark d-inline-flex text-decoration-none rounded">자바(프레임워크)</a></li>
						</ul>
					</div>
				</li>
				<li class="mb-1">
					<button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed"
						data-bs-toggle="collapse" data-bs-target="#user-collapse" aria-expanded="false">
						현재 접속중인 사람
					</button>
					<div class="collapse" id="user-collapse">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">네트워크</a></li>
							<li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">자바(기초)</a></li>
							<li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">자바(심화)</a></li>
							<li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">자바(프레임워크)</a>
							</li>
						</ul>
					</div>
				</li>
			</ul>
		</div>

	</div>

	<!-- Modal -->
	<div class="modal fade" id="updateUserModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content col-md-10 mx-auto col-lg-5">
				<div>
					<button type="button" style="float: right; margin-right: 10px; margin-top: 10px;" class="btn-close"
						data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="mx-auto py-3">
					<h3>정보 변경</h3>
				</div>
				<form class="p-4 p-md-5 border rounded-3 bg-light" method="POST" th:action="@{/user/update}"
					th:object="${user}" enctype="multipart/form-data">
					<div class="form-floating mb-3">
						<input type="nick" class="form-control" id="nick2" name="nick" placeholder="name" autofocus>
						<label for="nick2">닉네임(중복 불가, 4글자 이상)</label>
						<div id="nickNotice2" class="invalid-feedback">
							닉네임이 중복됩니다.
						</div>
					</div>
					<div class="form-floating mb-3">
						<input type="password" class="form-control" id="pwd3" th:field="*{pwd}" placeholder="password"
							minlength="6" maxlength="12" aria-describedby="pwdNotice">
						<label for="pwd3">비밀번호(6자리 이상, 12자리 이하)</label>
					</div>
					<div class="form-floating mb-3">
						<input type="password" class="form-control" placeholder="password" id="pwd_confirm2"
							minlength="6" maxlength="12" aria-describedby="pwdNotice">
						<label for="pwd_confirm2">비밀번호 확인</label>
						<div id="pwdNotice2" class="feedback" style="height: 20px;">
							비밀번호를 입력해주세요.
						</div>
					</div>
					<hr class="my-4">
					<div>
						<label for="profile" class="my-3">프로필 사진 변경</label>
						<input type="file" class="form-control" id="file" name="file"
							accept="image/gif, image/jpeg, image/png, image/jpg" autofocus>
					</div>
					<button type="submit" class="w-100 btn btn-lg btn-primary mt-4" onclick="return check2()">정보
						변경</button>
				</form>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<div class="modal fade" id="knowModal" tabindex="-1" aria-hidden="true">
		<!--모든 지식 팝업은 여기로 -> 정보만 바꾸기-->
		<div class="modal-dialog">
			<div class="modal-content col-md-10 mx-auto col-lg-5" style="width:700px; right: 100px;">
				<div style="margin-top: 10px;">
					<h6 id="knowNo" style="margin-left: 30px; float: left;">no.111</h6>
					<button type="button" style="float: right; margin-right: 10px;" class="btn-close"
						data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div style="margin-bottom: 20px;">
					<h2 id="knowName" style="text-align: center;">인터넷</h2>
				</div>
				<div class="p-4 p-md-5 border rounded-3 bg-light">
					<div id="knowCont">
						<p>- 여러 통신망을 하나로 연결하는 거대한 컴퓨터 통신망</p>
						<p>- 클라이언트와 서버가 연결되어 구성된 망을 컴퓨터 네트워크 라고 하며, TCP/IP 프로토콜을 통해 제공됨.</p>
						<p>- 즉, 수많은 컴퓨터 네트워크들로 구성된 집합체이다.</p>
						<p>- 인터넷은 서로 동시에 참여할 수 있는 쌍방향 통신을 제공한다.</p>
					</div>
					<hr class="my-4">
					<button class="btn btn-primary mb-3" type="button" data-bs-toggle="collapse"
						data-bs-target="#collapse1" aria-expanded="false" th:onclick="reply()">
						댓글
					</button>
					<div class="collapse" id="collapse1">
						<div class="modal-section">
							<div class="card card-body">
								<div id="reply-list">
									<!--댓글 목록-->
								</div>

								<!--로그인 하면 나오는 댓글 작성 칸-->
								<div class="row">
									<div class="col-1">
										<img>
										<!--작성자(현재 로그인 유저) 이미지-->
									</div>
									<div class="col-9">
										<input class="w-100 form-control" type="text" placeholder="댓글을 입력해주세요.">
									</div>
									<div class="col-2">
										<button type="button" id="" class="btn btn-primary">작성</button>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
		<script th:inline="javascript">
			var msg = [[${msg}]];
			if (msg != null) {
				alert(msg);
			}

			var loginUser = [[${session.loginUser}]];
			console.log(loginUser);

			function know(name) { // 문제의 정보를 받아서 팝업 -> ajax

				$.ajax({
					type: 'post',
					url: '/know/cont',
					data: {
						name: name,
					},

					success: function (data) {

						$('#knowNo').html('no.' + data.no);
						$('#knowName').html(data.name);

						if (data.cont.includes('/')) { // 내용이 2개 이상이고, 단답형
							var contArr = data.cont.split('/');
							var str = '';

							contArr.forEach((cont, index) => {
								str += '<p>- ' + cont + '</p>';
							});
							$('#knowCont').html(str);

						} else if (data.cont == '*') { // 테이블 형태 지식

							$.ajax({
								type: 'post',
								url: '/addi/cont',
								data: {
									no: data.no,
								},

								success: function (data) {
									str = '';
									str += '<table>';

									data.forEach((list, index) => {

										if (index == 0) { // 처음에는 th
											str += '<tr>';
											str += '<th>기준</th>';
											str += '<th>' + list.addi.comp1 + '</th>';
											str += '<th>' + list.addi.comp2 + '</th>';
											str += '</tr>';
										} else {
											str += '<tr>';
											str += '<td>' + list.addi.stand + '</td>';
											str += '<td>' + list.addi.comp1 + '</td>';
											str += '<td>' + list.addi.comp2 + '</td>';
											str += '</tr>';
										}
									});
									str += '</table>';

									$('#knowCont').html(str);
								},

								error: function (e) {
									console.log(e);
								}
							});

						} else if (data.cont.includes('*')) { // 테이블 형태가 아닌 주관식
							var contArr = data.cont.split('*');
							var str = '';

							contArr.forEach((cont, index) => {
								str += '<p>' + cont + '</p>';
							});
							$('#knowCont').html(str);
						} else {
							$('#knowCont').html('<p>- ' + data.cont + '</p>');
						}
					},

					error: function (e) {
						console.log(e);
					}
				});
			};

			function reply() {
				var no = $('#knowName').html().replace('no.', ''); // 번호만 추출

				$.ajax({
					type: 'post',
					url: '/reply/cont',
					data: {
						no: no,
					},

					success: function (data) {
						console.log(data);


					},

					error: function (e) {
						console.log(e);
					}
				});
			};

			$('#pwd_confirm2').keyup(function () {
				var pwd = $('#pwd3').val();
				var pwd_confirm = $('#pwd_confirm2').val();

				if (pwd == pwd_confirm) {
					var email = loginUser.email;
					console.log(email);

					$.ajax({
						type: 'post',
						url: '/check/pwd',
						data: {
							email: email,
							pwd: pwd,
						},

						success: function (data) {
							console.log(data);

							// 중복
							if (data == '1') {
								$('#pwd_confirm2').removeClass('is-valid');
								$('#pwd_confirm2').addClass('is-invalid');
								$('#pwdNotice2').html('원래 비밀번호와 같습니다.');
							} else {
								$('#pwd_confirm2').removeClass('is-invalid');
								$('#pwd_confirm2').addClass('is-valid');
								$('#pwdNotice2').html('비밀번호가 일치합니다.');
							}
						},

						error: function (e) {
							console.log(e);
						}
					});
				} else {
					$('#pwd_confirm2').removeClass('is-valid');
					$('#pwd_confirm2').addClass('is-invalid');
					$('#pwdNotice2').html('비밀번호가 일치하지 않습니다.');
				}
			});

			$('#nick2').keyup(function () {
				var nick = $('#nick2').val();

				$.ajax({
					type: 'get',
					url: '/check/nick',
					data: {
						nick: nick,
					},
					contentType: "application/json;charset=UTF-8",

					success: function (data) {
						console.log(data);

						// 중복
						if (data == '1') {
							$('#nick2').addClass('is-invalid');
						} else {
							$('#nick2').removeClass('is-invalid');
						}
					},

					error: function (e) {
						console.log(e);
					}
				});
			});

			function check2() {
				if ($('#nick2').hasClass('is-invalid') || $('#email2').hasClass('is-invalid') || $('#pwd_confirm2').hasClass('is-invalid')) {
					return false;
				} else {
					return true;
				}
			};
		</script>

</body>

</html>